@model InfosecAcademyBudgetManagement.Models.BudgetPlanEditViewModel

@{
    ViewData["Title"] = "Bütçe Düzenle";
    var monthNames = new[] { "Oca", "Şub", "Mar", "Nis", "May", "Haz", "Tem", "Ağu", "Eyl", "Eki", "Kas", "Ara" };
    var lineIndex = new Dictionary<string, int>();
    for (var i = 0; i < Model.Lines.Count; i++)
    {
        lineIndex[$"{Model.Lines[i].CategoryId}-{Model.Lines[i].Month}"] = i;
    }
}

<div class="page-header">
    <div>
        <h1 class="page-title">Bütçe Planı @Model.Year</h1>
        <div class="page-subtitle">Aylık bütçe dağılımını güncelleyin.</div>
    </div>
    <a asp-action="Report" asp-route-year="@Model.Year" class="btn btn-outline-secondary">
        <i class="bi bi-graph-up"></i> Rapor
    </a>
</div>

<div class="card content-card">
    <div class="card-body">
        <form asp-action="Edit" method="post">
            <input type="hidden" name="PlanId" value="@Model.PlanId" />
            <table class="table table-bordered align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Kategori</th>
@for (var m = 1; m <= 12; m++) {
                        <th>@monthNames[m - 1]</th>
}
                    </tr>
                </thead>
                <tbody>
@foreach (var category in Model.Categories) {
                    <tr>
                        <td class="fw-semibold">@category.Name</td>
@for (var m = 1; m <= 12; m++) {
                        var idx = lineIndex[$"{category.Id}-{m}"];
                        <td>
                            <input type="hidden" name="Lines[@idx].CategoryId" value="@Model.Lines[idx].CategoryId" />
                            <input type="hidden" name="Lines[@idx].Month" value="@Model.Lines[idx].Month" />
                            <input name="Lines[@idx].PlannedAmount"
                                   value="@Model.Lines[idx].PlannedAmount.ToString("0.##")"
                                   class="form-control form-control-sm text-end"
                                   inputmode="decimal" />
                        </td>
}
                    </tr>
}
                </tbody>
            </table>

            <div class="form-actions mt-3">
                <button type="submit" class="btn btn-primary">Planı Kaydet</button>
                <a asp-action="Index" class="btn btn-outline-secondary">Geri</a>
            </div>
        </form>
    </div>
</div>

