@model InfosecAcademyBudgetManagement.Models.AdvancedReportViewModel

@{
    ViewData["Title"] = "Gelişmiş Raporlar";
}

<div class="page-header">
    <div>
        <h1 class="page-title">Gelişmiş Raporlama</h1>
        <div class="page-subtitle">@Model.Year yılı gelir-gider ve net sonuç analizi.</div>
    </div>
</div>

<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="card content-card h-100"><div class="card-body"><div class="small text-muted">Toplam Gelir</div><div class="h3 text-success">@Model.TotalIncome.ToString("N2") TL</div></div></div>
    </div>
    <div class="col-md-4">
        <div class="card content-card h-100"><div class="card-body"><div class="small text-muted">Toplam Gider</div><div class="h3 text-danger">@Model.TotalExpense.ToString("N2") TL</div></div></div>
    </div>
    <div class="col-md-4">
        <div class="card content-card h-100"><div class="card-body"><div class="small text-muted">Net Sonuç</div><div class="h3 @(Model.Net >= 0 ? "text-success" : "text-danger")">@Model.Net.ToString("N2") TL</div></div></div>
    </div>
</div>

<div class="card content-card">
    <div class="card-body">
        <canvas id="advancedReportChart"></canvas>
    </div>
</div>

@section Scripts {
    <script src="~/lib/chart.js/dist/chart.umd.min.js"></script>
    <script>
        const labels = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.MonthLabels));
        const income = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.IncomeMonthly));
        const expense = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ExpenseMonthly));
        const net = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.NetMonthly));

        new Chart(document.getElementById("advancedReportChart"), {
            type: "line",
            data: {
                labels: labels,
                datasets: [
                    { label: "Gelir", data: income, borderColor: "#20c997", backgroundColor: "rgba(32,201,151,0.2)", fill: false },
                    { label: "Gider", data: expense, borderColor: "#dc3545", backgroundColor: "rgba(220,53,69,0.2)", fill: false },
                    { label: "Net", data: net, borderColor: "#0d6efd", backgroundColor: "rgba(13,110,253,0.2)", fill: false }
                ]
            },
            options: { responsive: true }
        });
    </script>
}
